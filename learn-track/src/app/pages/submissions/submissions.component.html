<div class="min-h-screen bg-gray-100 flex">
  <!-- Sidebar (same as dashboard) -->
  <aside class="w-64 bg-white shadow-md hidden sticky md:block top-0 h-screen">
    <div class="p-6 border-b">
      <img src="assets/mylogo.png" alt="Logo" class="h-15 w-auto" />
    </div>
    <nav class="mt-6 space-y-2 px-4">
      <a routerLink="/dashboard" class="block px-3 py-2 rounded-lg hover:bg-orange-600 hover:text-white">ğŸ  Dashboard</a>
      <a routerLink="/submissions" class="block px-3 py-2 rounded-lg hover:bg-orange-600 hover:text-white">ğŸ“‚ Submissions</a>
      <a href="#" class="block px-3 py-2 rounded-lg hover:bg-blue-100">âš™ï¸ Settings</a>

      <div class="px-6 ">
        <button class="w-full mt-80 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-800" (click)="logout()">
          Logout
        </button>
      </div>
    </nav>
  </aside>

  <!-- Main content -->
  <main class="flex-1 p-6">
    <!-- inline message -->
    <div *ngIf="message" class="mb-4 p-3 rounded"
         [ngClass]="{
           'bg-green-100 text-green-700': messageType === 'success',
           'bg-red-100 text-red-700': messageType === 'error'
         }">
      {{ message }}
    </div>

    <h2 class="text-2xl font-semibold text-orange-600 uppercase mb-4">Submit a New Entry</h2>

    <form class="bg-white p-6 rounded-xl text-orange-600 shadow mb-6" (ngSubmit)="submitSubmission()">
      <textarea
        [(ngModel)]="details"
        name="notes"
        placeholder="Enter your submission notes"
        class="w-full p-3 border rounded mb-4 resize-none"
        rows="4"
        required
      ></textarea>

      <input type="file" (change)="handleFileInput($event)" class="mb-4" />

      <!-- File preview -->
      <div *ngIf="filePreview" class="mb-4">
        <p class="text-gray-600 mb-2">Preview:</p>
        <img [src]="filePreview" class="h-32 w-32 object-cover rounded" />
      </div>

      <button
        type="submit"
        [disabled]="uploading"
        class="px-4 py-2 bg-orange-600 text-white rounded hover:bg-orange-700 w-60"
      >
        {{ uploading ? 'Submitting...' : 'Submit' }}
      </button>
    </form>

    <h3 class="text-lg font-semibold mb-4">All Submissions</h3>
    <div class="bg-white rounded-xl shadow p-6 overflow-x-auto">
      <table class="w-full text-left border-collapse">
        <thead>
          <tr class="text-gray-600 border-b">
            <th class="pb-2 border-2 p-8">#</th>
            <th class="pb-2 border-2 p-10 w-25">Notes</th>
            <th class="pb-2 py-2 border-2 p-10">Screenshot</th>
            <th class="pb-2 py-2 border-2 p-10">Date</th>
            <th class="pb-2 py-2 border-2 p-10">Status</th>
            <th class="pb-2 py-2 border-2 p-10">Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let submission of submissions; index as i" class="border-b align-top">
            <td class="py-2 border-2 p-8 align-top">{{ i + 1 }}</td>
            <td class="py-2 border-2 p-10 w-25 align-top break-words">{{ submission.details }}</td>
            <td class="py-2 border-2 p-10 align-top">
              <img *ngIf="submission.screenshot_path"
                   [src]="'http://localhost:8000/storage/' + submission.screenshot_path"
                   alt="Screenshot"
                   class="h-16 w-16 object-cover rounded" />
              <span *ngIf="!submission.screenshot_path">N/A</span>
            </td>
            <td class="py-2 border-2 p-10 align-top">{{ submission.created_at | date:'medium' }}</td>
            <td class="py-2 border-2 p-10 align-top">
              <span class="px-2 py-1 rounded text-xs"
                    [ngClass]="{
                      'bg-green-100 text-green-700': submission.status === 'approved',
                      'bg-yellow-100 text-yellow-700': submission.status === 'pending',
                      'bg-red-100 text-red-700': submission.status === 'rejected'
                    }">
                {{ submission.status }}
              </span>
            </td>

            <!-- Actions column -->
            <td class="py-2 border-2 p-6 align-top">
              <button (click)="openEditModal(submission)" class="text-blue-600 hover:underline mr-2">Edit</button>
              <button (click)="deleteSubmission(submission.id)" class="text-red-600 hover:underline">Delete</button>
            </td>
          </tr>

          <tr *ngIf="submissions.length === 0">
            <td colspan="6" class="text-center py-4 text-gray-500">No submissions found.</td>
          </tr>
        </tbody>
      </table>
    </div>
  </main>

  <!-- Edit Modal -->
  <div *ngIf="showEditModal" class="fixed inset-0 z-50 flex items-center justify-center">
    <!-- backdrop -->
    <div class="absolute inset-0 bg-black opacity-40" (click)="closeEditModal()"></div>

    <!-- modal -->
    <div class="relative bg-white w-full max-w-2xl p-6 rounded-lg shadow-lg z-10">
      <h3 class="text-lg font-semibold mb-4">Edit Submission</h3>

      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-1">Details</label>
        <textarea [(ngModel)]="editDetails" name="editDetails" rows="4"
                  class="w-full p-3 border rounded"></textarea>
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium text-gray-700 mb-1">Replace Screenshot (optional)</label>
        <input type="file" (change)="handleEditFileInput($event)" />
      </div>

      <!-- current image and preview -->
      <div class="flex items-start gap-4 mb-4">
        <div *ngIf="currentScreenshotPath">
          <p class="text-sm text-gray-600 mb-2">Current:</p>
          <img [src]="'http://localhost:8000/storage/' + currentScreenshotPath" class="h-24 w-24 object-cover rounded" />
        </div>

        <div *ngIf="editFilePreview">
          <p class="text-sm text-gray-600 mb-2">Preview (new):</p>
          <img [src]="editFilePreview" class="h-24 w-24 object-cover rounded" />
        </div>
      </div>

      <div class="flex justify-end gap-3">
        <button (click)="closeEditModal()" class="px-4 py-2 border rounded">Cancel</button>
        <button (click)="saveEdit()" class="px-4 py-2 bg-green-600 text-white rounded" [disabled]="uploading">
          {{ uploading ? 'Saving...' : 'Save changes' }}
        </button>
      </div>
    </div>
  </div>
</div>
